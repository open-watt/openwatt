#
# Legend:
#
# reg: number (40000), type (u16), units (10mAh)
#	desc: id, display_units, sample_frequency, user_description
#	valueid: val0, val1, ...
#	valuedesc: "Value 0", "Value 1", ...
#	map-local: device.component.element
#	map-mb: server_name, register_number_or_id
#

#
# TAiYEDQ TAC2100:
#  https://www.kdocs.cn/l/cnQKPZECE6eY
#

enum: LoadNature
	resistive: 0, "Resistive"
	inductive: 1, "Inductive"
	capacitive: 2, "Capacitive"
	nonload: 3, "Non Load"

enum: BaudRate
	_1200: 0, "1200"
	_2400: 1, "2400"
	_4800: 2, "4800"
	_9600: 3, "9600"
	_19200: 4, "19200"
	_38400: 5, "38400"

enum: ParityStop
	no_parity_1_stop: 0, "no parity, 1 stop bit"
	even_parity_1_stop: 1, "even parity, 1 stop bit"
	odd_parity_1_stop: 2, "odd parity, 1 stop bit"
	no_parity_2_stop: 3, "no parity, 2 stop bits"

enum: Pulse1OutputMode
	import_active_energy: 1, "Import active energy"
	total_active_energy: 2, "Total active energy (import + export)"
	export_active_energy: 4, "Export active energy"
	import_reactive_energy: 5, "Import reactive energy"
	total_reactive_energy: 6, "Total reactive energy (import + export)"
	export_reactive_energy: 8, "Export reactive energy"

enum: Pulse1Output
	_1wh: 0, "1Wh/imp"
	_10wh: 1, "10Wh/imp"
	_100wh: 2, "100Wh/imp"
	_1kwh: 3, "1kWh/imp"
	_10kwh: 4, "10kWh/imp"
	_100kwh: 5, "100kWh/imp"
	_1mwh: 6, "1mWh/imp"


registers:
	# float regs
	reg: 30000, f32, V,					desc: voltage
	reg: 30006, f32, A,					desc: current
	reg: 30012, f32, W,					desc: activePower
	reg: 30018, f32, var,				desc: reactivePower
	reg: 30024, f32, VA,				desc: apparentPower
	reg: 30030, f32,					desc: powerFactor
	reg: 30036, f32, deg,				desc: phase
	reg: 30048, f32, Hz,				desc: frequency
	reg: 30078, enumf32, LoadNature,	desc: nature
	reg: 30140, f32, W,					desc: activePowerDemand
	reg: 30142, f32, var,				desc: reactivePowerDemand
	reg: 30144, f32, VA,				desc: apparentPowerDemand
	reg: 30146, f32, A,					desc: currentDemand
	reg: 30154, f32, W,					desc: importActivePowerDemand
	reg: 30156, f32, W,					desc: exportActivePowerDemand
	reg: 30162, f32, W,					desc: maximumActivePowerDemand
	reg: 30164, f32, var,				desc: maximumReactivePowerDemand
	reg: 30166, f32, VA,				desc: maximumApparentPowerDemand
	reg: 30168, f32, A,					desc: maximumCurrentDemand
	reg: 30176, f32, W,					desc: maximumImportActivePowerDemand
	reg: 30178, f32, W,					desc: maximumExportActivePowerDemand
	reg: 31280, f32, kWh,				desc: totalImportActiveEnergy
	reg: 31282, f32, kWh,				desc: totalExportActiveEnergy
	reg: 31284, f32, kWh,				desc: totalActiveEnergy
	reg: 31288, f32, kvarh,				desc: totalImportReactiveEnergy
	reg: 31290, f32, kvarh,				desc: totalExportReactiveEnergy
	reg: 31292, f32, kvarh,				desc: totalReactiveEnergy

	# int regs
	reg: 40000, u32, 10mV,				desc: voltage_i
	reg: 40006, u32, mA,				desc: current_i
	reg: 40012, i32, W,					desc: activePower_i
	reg: 40018, i32, var,				desc: reactivePower_i
	reg: 40024, u32, VA,				desc: apparentPower_i
	reg: 40030, i16, 0.001,				desc: powerFactor_i
	reg: 40033, i16, 0.01deg,			desc: phase_i
	reg: 40042, u16, 0.01Hz,			desc: frequency_i
	reg: 40070, enum16, LoadNature,		desc: nature_i
	reg: 40102, i32, W,					desc: activePowerDemand_i
	reg: 40104, i32, var,				desc: reactivePowerDemand_i
	reg: 40106, u32, VA,				desc: apparentPowerDemand_i
	reg: 40108, u32, mA,				desc: currentDemand_i
	reg: 40116, u32, W,					desc: importActivePowerDemand_i
	reg: 40118, u32, W,					desc: exportActivePowerDemand_i
	reg: 40124, i32, W,					desc: maximumActivePowerDemand_i
	reg: 40126, i32, var,				desc: maximumReactivePowerDemand_i
	reg: 40128, u32, VA,				desc: maximumApparentPowerDemand_i
	reg: 40130, u32, mA,				desc: maximumCurrentDemand_i
	reg: 40138, u32, W,					desc: maximumImportActivePowerDemand_i
	reg: 40140, u32, W,					desc: maximumExportActivePowerDemand_i
	reg: 41024, u32, 10Wh,				desc: totalImportActive_i
	reg: 41026, u32, 10Wh,				desc: totalExportActive_i
	reg: 41028, u32, 10Wh,				desc: totalActiveEnergy_i
	reg: 41032, u32, 10varh,			desc: totalImportReactive_i
	reg: 41034, u32, 10varh,			desc: totalExportReactive_i
	reg: 41036, u32, 10varh,			desc: totalReactiveEnergy_i

	# config
	reg: 60480, u16/RW,					desc: keyParameterProgrammingAuthorization
	reg: 60482, u16/RW, min,			desc: demandPeriod
	reg: 60483, u16/RW, min,			desc: slideTime
	reg: 60485, u16/RW,					desc: modbusAddress
	reg: 60486, enum16/RW, BaudRate,	desc: networkBaudRate
	reg: 60487, enum16/RW, ParityStop,	desc: parityAndStopBit
	reg: 60488, u16/RW,					desc: password
	reg: 60489, enum16/RW, Pulse1OutputMode,	desc: pulse1EnergyType
	reg: 60490, enum16/RW, Pulse1Output,		desc: pulse1Constant
	reg: 60491, u16/RW, ms,				desc: pulse1Width
	reg: 60504, u16/RW, s,				desc: automaticScrollDisplayTime
	reg: 60505, u16/RW, min,			desc: backlitTime
	reg: 60540, u32/RW, min,			desc: runningTime
	reg: 60542, u32/RW, min,			desc: runningTimeWithLoad
	reg: 62016, u16/W,					desc: resetHistoricalData

	# constant data
	reg: 62017, u16/R,					desc: meterCode
	reg: 62018, u32/R,					desc: serialNumber
	reg: 62020, u16/R,					desc: softwareVersion
	reg: 62021, u16/R,					desc: hardwareVersion
	reg: 62022, u16/R,					desc: versionNumberOfDisplayed

device-template:
	component:
		id: info
		template: DeviceInfo
		element: type, "energy-meter"
		element: name, "TAC Series"
		element-map: model_id, @meterCode,							desc: , const, "Model Number", "The code of the meter."
		element-map: serial_number, @serialNumber,					desc: , const, "Serial Number", "The serial number of the meter."
		element-map: hardware_version, @hardwareVersion,			desc: , const, "Hardware Version", "Hardware version number: XX.YY. First byte = XX, second byte = YY."
		element-map: software_version, @softwareVersion,			desc: , const, "Software Version", "Software version number: XX.YY. First byte = XX, second byte = YY."
	component:
		id: status
		template: DeviceStatus
		element-map: running_time, @runningTime,					desc: min, medium, "Total Running Time", "Running time in minutes. Write 0 to reset the running time."
		element-map: running_time_with_load, @runningTimeWithLoad,	desc: min, medium, "Running Time With Load", "Running time with load in minutes. Write 0 to reset the running time with load."
	component:
		id: meter
		template: EnergyMeter
		element: type, "single-phase"
		element-map: voltage, @voltage
		element-map: current, @current
		element-map: power, @activePower
		element-map: apparent, @apparentPower
		element-map: reactive, @reactivePower
		element-map: pf, @powerFactor
		element-map: frequency, @frequency
		element-map: phase, @phase
		element-map: nature, @nature,								desc: , medium, "Load Nature"
		# cumulative energy
		element-map: import, @totalImportActiveEnergy
		element-map: export, @totalExportActiveEnergy
		element-map: net, @totalActiveEnergy
		element-map: import_reactive, @totalImportReactiveEnergy
		element-map: export_reactive, @totalExportReactiveEnergy
		element-map: net_reactive, @totalReactiveEnergy
		# demand
		element-map: active_power_demand, @activePowerDemand
		element-map: reactive_power_demand, @reactivePowerDemand
		element-map: apparent_power_demand, @apparentPowerDemand
		element-map: current_demand, @currentDemand
		element-map: import_active_power_demand, @importActivePowerDemand
		element-map: export_active_power_demand, @exportActivePowerDemand
		element-map: maximum_active_power_demand, @maximumActivePowerDemand
		element-map: maximum_reactive_power_demand, @maximumReactivePowerDemand
		element-map: maximum_apparent_power_demand, @maximumApparentPowerDemand
		element-map: maximum_current_demand, @maximumCurrentDemand
		element-map: maximum_import_active_power_demand, @maximumImportActivePowerDemand
		element-map: maximum_export_active_power_demand, @maximumExportActivePowerDemand
	component:
		id: config
		template: Configuration
#		element-map: key_parameter_programming_authorization, @keyParameterProgrammingAuthorization,	desc: , config, "KPPA", "Read: to get the status of the KPPA - 0 = not authorizedï¼› 1 = authorized. Write the correct password to get KPPA, enable to program key parameters."
		element-map: demand_period, @demandPeriod,					desc: min, config, "Demand Period", "Write demand period: 0~60 minutes (default 60). 0 means function update every second."
		element-map: slide_time, @slideTime,						desc: min, config, "Slide Time", "1 ~ (Demand Period -1) (default 1 min)."
		element-map: password, @password,							desc: , config, "Password", "(default: 0000) Read: to get the password of the meter. Write: to program the new password of the meter. (KPPA is asked)"
		element-map: pulse1_energy_type, @pulse1EnergyType,			desc: , config, "Pulse Output Type"
		element-map: pulse1_constant, @pulse1Constant,				desc: , config, "Pulse Rate"
		element-map: pulse1_width, @pulse1Width,					desc: ms, config, "Pulse On Period", "Pulse on period in milliseconds: 60, 100 or 200 (default 100). Note: The pulse width time cannot be set to 200ms when the pulse constant is equal to 1000 imp/kWh(kvarh)."
		element-map: auto_scroll_display_time, @automaticScrollDisplayTime,	desc: s, config, "Automatic Scroll Display Time", "(default: 0) Note: 0 means stop automatic scroll display."
		element-map: backlit_time, @backlitTime,					desc: min, config, "Backlit Time", "(default: 60). Range 0~120 or 255; 0 means backlit always on; 255 means backlit always off."
		element-map: reset_historical_data, @resetHistoricalData,	desc: , config, "Reset Historical Data", "0 = reset max. demand. (KPPA is asked)"
		component:
			id: modbus
			template: ModbusConfig
			element-map: address, @modbusAddress
			element-map: baud_rate, @networkBaudRate
			element-map: parity_and_stop, @parityAndStopBit,		desc: , config, "Parity And Stop Bits"
